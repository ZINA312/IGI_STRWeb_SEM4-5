
{% extends 'main/layout.html' %}
{% load static %}

{% block head %}
    <meta charset="UTF-8">
    <meta name="description" content="Агентство недвижимости, предлагающее лучшие предложения по продаже и аренде недвижимости. Мы поможем вам найти идеальный дом или квартиру.">
    <meta name="keywords" content="недвижимость, купить квартиру, продать дом, аренда, агентство недвижимости">
    <meta name="author" content="Harmony">


{% endblock %}

{% block title %}Главная страница{% endblock %}

{% block content %}
    {% if user.is_superuser %}
        <h2>Добавить недвижимость</h2>
        <form method="POST" action="{% url 'add_property' %}" enctype="multipart/form-data">
            {% csrf_token %}
            {{ property_form.as_p }}
            <button type="submit">Добавить</button>
        </form>
    {% endif %}
    
    <div style="display: flex; justify-content: space-between;">
        <div style="flex: 1; margin-right: 20px;">
            <br>
            <img src="{% static 'ad_banners/main_page_banner.png' %}" style="display:block; margin-left: auto; margin-right: auto; width: 50%">
            <br>

            <div style="background-color: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <form method="get" action="" style="display: flex; gap: 30px;">
                    <div style="display: flex; align-items: center;">
                        <label for="sort_price" style="font-family: Arial, Helvetica, sans-serif; margin-right: 10px; color: #333;">По цене:</label>
                        <select name="sort_price" id="sort_price" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;">
                            <option value="" style="font-family: Arial, Helvetica, sans-serif;">Без сортировки</option>
                            <option value="asc" style="font-family: Arial, Helvetica, sans-serif;" {% if sort_price == 'asc' %}selected{% endif %}>По возрастанию</option>
                            <option value="desc" style="font-family: Arial, Helvetica, sans-serif;" {% if sort_price == 'desc' %}selected{% endif %}>По убыванию</option>
                        </select>
                    </div>
                    <div style="display: flex;align-items: center; flex-direction: row;">
                        <label for="sort_category" style="font-family:Arial, Helvetica, sans-serif;vertical-align:middle; color: #333;margin-right: 10px;">По категории: </label>
                        <select name="sort_category" id="sort_category" style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;">
                            <option value="" style="font-family:Arial, Helvetica, sans-serif;">Без сортировки</option>
                            {% for category in categories %}
                            <option value="{{ category.name }}" {% if sort_category == category.name %}selected{% endif %}>{{ category.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" style="padding: 5px 10px; background-color: #3498db; color: white; border: none; border-radius: 5px;">Применить</button>
                </form>
            </div>

            <div style="max-height: 600px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; scrollbar-width: none; -ms-overflow-style: none;">
                <div style="display: flex; flex-wrap: wrap; justify-content: space-between;">
                    {% for property in properties %}
                    <div itemscope itemtype="http://schema.org/RealEstateListing" style="flex: 0 0 calc(33.33% - 10px); margin-bottom: 20px;">
                        <img src="{{ property.image.url }}" alt="{{ property.title }}" style="width: 100%; height: 150px; object-fit: cover;" itemprop="image">
                        <div style="padding: 15px;">
                            <h3 itemprop="name" style="font-family:Arial, Helvetica, sans-serif;margin: 0 0 10px; font-size: 1.2em; color: #333;">{{ property.title }}</h3>
                            <p itemprop="description" style="font-family:Arial, Helvetica, sans-serif;margin: 0 0 10px; color: #666;">{{ property.description }}</p>
                            <p style="font-family:Arial, Helvetica, sans-serif;font-weight: bold; color: #000000;" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
                                
                                <span itemprop="price" content="{{ property.price }}">{{ property.price }} </span>
                                <span itemprop="priceCurrency" content="RUB">руб.</span>
                            </p>
                            <a href="{% url 'property_detail' property.id %}" style="padding: 5px 10px; background-color: #3498db; color: white; border: none; border-radius: 5px; text-decoration: none;">Подробнее</a>
                        </div>
                    </div>
                    {% empty %}
                    <p style="font-family:Arial, Helvetica, sans-serif;">Нет доступных недвижимостей.</p>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div style="flex: 0 0 300px; background-color: #f9f9f9; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
            <h3 style="font-family:Arial, Helvetica, sans-serif; font-size: 1.5em; margin-bottom: 10px; color: #333;">Последняя новость</h3>
            {% if latest_article %}
                <div style="margin-bottom: 15px;">
                    <img src="{{ latest_article.image.url }}" alt="Изображение новости" style="width: 100%; border-radius: 8px; height: auto;">
                    <h4 style="font-family:Arial, Helvetica, sans-serif;margin: 10px 0; font-size: 1.2em; color: #3498db;">{{ latest_article.title }}</h4>
                    <p style="font-family:Arial, Helvetica, sans-serif;color: #666; line-height: 1.5;">{{ latest_article.content|truncatewords:30 }}</p>
                </div>
            {% else %}
                <p style="font-family:Arial, Helvetica, sans-serif;color: #999;">Нет новостей.</p>
            {% endif %}
            <hr style="border: none; border-top: 1px solid #999; margin: 15px 0; width:100%">
            <img src="{% static 'ad_banners/main_page_banner2.jpg' %}" style="display:block; margin-left: auto; margin-right: auto; width:90%">
        </div>
    </div>

    <div style="margin-top: 30px;">
        <h2 style="font-family: Arial, Helvetica, sans-serif; color: #333;">Компании-партнеры</h2>
        <div style="display: flex; flex-wrap: wrap; justify-content: space-between;">
            {% for partner in partners %}
            <div style="display: flex; align-items: center; width: calc(50% - 10px); margin-bottom: 20px; text-align: left;">
                <img src="{{ partner.image.url }}" alt="{{ partner.name }}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px; margin-right: 20px;">
                <div style="flex: 1;">
                    <h4 style="font-family: Arial, Helvetica, sans-serif; color: #3498db; margin: 0;">{{ partner.name }}</h4>
                    <p style="font-family: Arial, Helvetica, sans-serif; color: #666; margin: 5px 0;">{{ partner.description }}</p>
                    <a href="{{ partner.website }}" target="_blank" style="padding: 5px 10px; background-color: #3498db; color: white; border: none; border-radius: 5px; text-decoration: none;">Перейти на сайт</a>
                </div>
            </div>
            {% empty %}
            <p style="font-family:Arial, Helvetica, sans-serif;">Нет партнеров.</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}